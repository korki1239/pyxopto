

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>The layer stack &mdash; PyXOpto 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scattering phase functions" href="phase_function.html" />
    <link rel="prev" title="Layered MC" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> PyXOpto
          

          
            
            <img src="../../_static/xopto_logo_dark.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../opencl_devices.html">OpenCL devices</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Layered MC</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">The layer stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="phase_function.html">Scattering phase functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="source.html">Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="detector.html">Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="surface_layout.html">Surface layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluence.html">Fluence</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace.html">Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampling_volume.html">Sampling volume</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulator_data_types.html">Simulator data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulator_options.html">Simulator options</a></li>
<li class="toctree-l2"><a class="reference internal" href="opencl_build_options.html">OpenCL build options</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mccyl/index.html">Cylindrical MC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mcvox/index.html">Voxelized MC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/index.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/modules.html">xopto</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyXOpto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Layered MC</a> &raquo;</li>
        
      <li>The layer stack</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-layer-stack">
<span id="mcml-layer-stack-label"></span><h1>The layer stack<a class="headerlink" href="#the-layer-stack" title="Permalink to this headline">¶</a></h1>
<p>The sample and the surrounding medium are described by a stack of layers.
The layers are stacked along the positive z-axis. The first layer
in the stack is used to describe the medium above the top sample
surface and the last layer in the stack is used to describe the
medium bellow the bottom sample surfaces.</p>
<p>The classes that allow definition of individual layers and forming of
layer stacks can be found in the <a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#module-xopto.mcml.mclayer.layer" title="xopto.mcml.mclayer.layer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mcml.mclayer.layer</span></code></a> module. The
module is for convenience also imported into the main simulator module
<a class="reference internal" href="../../apidoc/xopto.mcml.mc.html#module-xopto.mcml.mc" title="xopto.mcml.mc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mcml.mc</span></code></a>.</p>
<p>A layer is an instance of <a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer" title="xopto.mcml.mclayer.layer.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">xopto.mcml.mclayer.layer.Layer</span></code></a>. The
constructor takes several parameters that define the geometry and
optical properties of the layer material.</p>
<ol class="arabic simple">
<li><p>The layer thickness is defined by parameter <code class="code docutils literal notranslate"><span class="pre">d</span></code> (m).</p></li>
<li><p>The refractive index is defined by parameter <code class="code docutils literal notranslate"><span class="pre">n</span></code>.</p></li>
<li><p>The scattering coefficient is defined by parameter <code class="code docutils literal notranslate"><span class="pre">mus</span></code> (m <sup>-1</sup>).</p></li>
<li><p>The absorption coefficient is defined by parameter <code class="code docutils literal notranslate"><span class="pre">mua</span></code> (m <sup>-1</sup>).</p></li>
<li><p>The scattering phase function is defined by parameter <code class="code docutils literal notranslate"><span class="pre">pf</span></code> that can
be any instance of <a class="reference internal" href="../../apidoc/xopto.mcbase.mcpf.pfbase.html#xopto.mcbase.mcpf.pfbase.PfBase" title="xopto.mcbase.mcpf.pfbase.PfBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">xopto.mcbase.mcpf.pfbase.PfBase</span></code></a>.</p></li>
</ol>
<p>The following example creates a layer with a refractive index 1.33,
absorption coefficient 1 cm <sup>-1</sup> , scattering coefficient
50 cm <sup>-1</sup>, thickness 10 mm and Henyey-Greenstein
scattering phase function with anisotropy 0.9.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xopto.mcml</span> <span class="kn">import</span> <span class="n">mc</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.33</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">50.0e2</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.9</span><span class="p">))</span>
</pre></div>
</div>
<p>All the optical and geometrical properties of a layer that were set
through the constructor <a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer" title="xopto.mcml.mclayer.layer.Layer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xopto.mcml.mclayer.layer.Layer()</span></code></a> can be
later changed through accessing the instance properties. In case of
the scattering phase function, first access the
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer.pf" title="xopto.mcml.mclayer.layer.Layer.pf"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pf</span></code></a> layer property
and from there any of the properties implemented by the scattering
phase function model. Note that the Henyey-Greenstein scattering phase
function from this example exposes only the anisotropy
<a class="reference internal" href="../../apidoc/xopto.mcbase.mcpf.hg.html#xopto.mcbase.mcpf.hg.Hg.g" title="xopto.mcbase.mcpf.hg.Hg.g"><code class="xref py py-attr docutils literal notranslate"><span class="pre">g</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">mua</span> <span class="o">=</span> <span class="mf">0.5e2</span>
<span class="n">layer</span><span class="o">.</span><span class="n">mus</span> <span class="o">=</span> <span class="mf">40.0e2</span>
<span class="n">layer</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="mf">0.015</span>
<span class="n">layer</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mf">1.452</span>
<span class="n">layer</span><span class="o">.</span><span class="n">pf</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mf">0.9</span>
</pre></div>
</div>
<p>The individual layers are then combined into a stack through the
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layers" title="xopto.mcml.mclayer.layer.Layers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Layers()</span></code></a>. The constructor takes a list
of <a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer" title="xopto.mcml.mclayer.layer.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a>. The created instance
manages the transfer of data between the host and the OpenCL device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layers</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span>  <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">50.0e2</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)),</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span>  <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first and last layer in the stack represent the surrounding
medium. The absorption coefficient <code class="code docutils literal notranslate"><span class="pre">mua</span></code>, scattering coefficient
<code class="code docutils literal notranslate"><span class="pre">mus</span></code> and the scattering phase function <code class="code docutils literal notranslate"><span class="pre">pf</span></code> of the
topmost and bottommost layers are not used in the MC simulations, since the
photon packets are not propagated through the surrounding medium.
However, the refractive index <code class="code docutils literal notranslate"><span class="pre">n</span></code> of the two outermost
layers is used to properly refract/reflect the photon packet at the layer
boundaries when launched by the source or when escaping the sample.</p>
</div>
<p>The properties of layers in the layer stack can be modified at any time
through accessing the individual layers and from there the layer
properties. The number of layers (including the two layers of the surrounding
medium) can be determined through the builtin <code class="xref py py-func docutils literal notranslate"><span class="pre">len()</span></code>. The individual
layers can be accessed using the <code class="code docutils literal notranslate"><span class="pre">[]</span></code> operator or
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layers.layer" title="xopto.mcml.mclayer.layer.Layers.layer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">layer()</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mua</span> <span class="o">=</span> <span class="mf">0.5e2</span>
<span class="n">layers</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mua</span> <span class="o">=</span> <span class="mf">0.5e2</span>

<span class="n">num_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layers" title="xopto.mcml.mclayer.layer.Layers"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layers</span></code></a> and
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer" title="xopto.mcml.mclayer.layer.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a> produce an informative
human-readable output when used with the <code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code> builtin.</p>
<p>Applying <code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code> to an individual layer (instances of
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layer" title="xopto.mcml.mclayer.layer.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a>) will produce the following output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Layer(d=0.1, n=1.3, mua=100.0, mus=5000.0, pf=Hg(g=0.9)) # id 0x7F15B4CEF820.
</pre></div>
</div>
<p>Applying <code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code> to a layer stack  (instance of
<a class="reference internal" href="../../apidoc/xopto.mcml.mclayer.layer.html#xopto.mcml.mclayer.layer.Layers" title="xopto.mcml.mclayer.layer.Layers"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layers</span></code></a>) will produce the following output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Layers([
    Layer(d=0.0, n=1.0, mua=0.0, mus=0.0, pf=Hg(g=0.0)),  # medium above the sample,
    Layer(d=0.1, n=1.3, mua=100.0, mus=5000.0, pf=Hg(g=0.9)),
    Layer(d=0.0, n=1.0, mua=0.0, mus=0.0, pf=Hg(g=0.0))   # medium bellow the sample
]) # id 0x7F15B4CEFD30.
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="phase_function.html" class="btn btn-neutral float-right" title="Scattering phase functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Layered MC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, XOpto team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>