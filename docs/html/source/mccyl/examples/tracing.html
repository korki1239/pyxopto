

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Photon packet tracing &mdash; PyXOpto 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Voxelized MC" href="../../mcvox/index.html" />
    <link rel="prev" title="Basic example" href="basic_example.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> PyXOpto
          

          
            
            <img src="../../../_static/xopto_logo_dark.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl_devices.html">OpenCL devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mcml/index.html">Layered MC</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Cylindrical MC</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../layer_stack.html">The layer stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phase_function.html">Scattering phase functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../source.html">Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../detector.html">Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../surface_layout.html">Surface layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fluence.html">Fluence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trace.html">Trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sampling_volume.html">Sampling volume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator_data_types.html">Simulator data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulator_options.html">Simulator options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opencl_build_options.html">OpenCL build options</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic_example.html">Basic example</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Photon packet tracing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-layer-stack">The layer stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-photon-packet-source">The photon packet source</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-trace">The trace</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-opencl-device">The OpenCL device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-monte-carlo-simulator">The Monte Carlo simulator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualization-of-results">Visualization of results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-complete-example">The complete example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mcvox/index.html">Voxelized MC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset/index.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/modules.html">xopto</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyXOpto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Cylindrical MC</a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Photon packet tracing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="photon-packet-tracing">
<span id="mccyl-tracing-example-label"></span><h1>Photon packet tracing<a class="headerlink" href="#photon-packet-tracing" title="Permalink to this headline">¶</a></h1>
<p>In this example we trace photon packets of a collimated Gaussian beam that
passes through an absorbing glass cylinder.</p>
<p>This example is available in the <cite>examples/mccyl/tracing.py</cite> file.</p>
<p>The functionality of cylindrical Monte Carlo (MC) is available through the
<a class="reference internal" href="../../../apidoc/xopto.mccyl.mc.html#module-xopto.mccyl.mc" title="xopto.mccyl.mc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mccyl.mc</span></code></a> module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xopto.mccyl</span> <span class="kn">import</span> <span class="n">mc</span>
</pre></div>
</div>
<div class="section" id="the-layer-stack">
<h2>The layer stack<a class="headerlink" href="#the-layer-stack" title="Permalink to this headline">¶</a></h2>
<p>The concentric layers of the medium can be defined through the
<a class="reference internal" href="../../../apidoc/xopto.mccyl.mclayer.html#module-xopto.mccyl.mclayer" title="xopto.mccyl.mclayer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mccyl.mclayer</span></code></a> submodule. The concentric layers are stacked
from the outermost to the innermost layer and centered at <img class="math" src="../../../_images/math/d4e15fcd7ca5f5bf43681bba3f96d0c4ff08733b.png" alt="(x,y)=(0,0)"/>.</p>
<p>The outermost layer of the stack is used to describe the
medium that surrounds the sample. Therefore, at least two layers must be always
defined, namely the layer of the surrounding medium and one sample layer!</p>
<p>The diameter of the outermost layers will be automatically set to infinity
regardless of the specified layer diameter.</p>
<p>Note that all the layers in the stack must use the same scattering phase
function model. A variety of scattering phase function models is available
through the <a class="reference internal" href="../../../apidoc/xopto.mccyl.mcpf.html#module-xopto.mccyl.mcpf" title="xopto.mccyl.mcpf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mccyl.mcpf</span></code></a> submodule.</p>
<p>The outer diameter of the cylinder is set to 10 mm and the
refractive index to 1.45, the absorption coefficient
mua=1.0 cm <sup>-1</sup> and the scattering coefficient to
mua=0.0 cm <sup>-1</sup></p>
<p>The glass cylinder is surrounded by a 20 mm thick layer of air with a
arefractive index of 1.0.</p>
<p>The sourrounding medium is also set to air with a arefractive index of 1.0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layers</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>  <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span>  <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">50e-3</span><span class="p">,</span>  <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span>  <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.45</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">10e-3</span><span class="p">,</span>   <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span>  <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that the absorption coefficient <code class="code docutils literal notranslate"><span class="pre">mua</span></code>, scattering coefficient
<code class="code docutils literal notranslate"><span class="pre">mus</span></code> and the scattering phase function <code class="code docutils literal notranslate"><span class="pre">pf</span></code> of the
outermost layer are not used in the MC simulations, since the
photon packets are not propagated through the surrounding medium.
However, the refractive index <code class="code docutils literal notranslate"><span class="pre">n</span></code> of the two outermost
layer is used to properly refract/reflect the photon packet at the sample
surface when launched by the source or when escaping the sample.
The layer diameter <code class="code docutils literal notranslate"><span class="pre">d</span></code> should be given in m and the values of the
scattering coefficient <code class="code docutils literal notranslate"><span class="pre">mus</span></code> and absorption coefficient
<code class="code docutils literal notranslate"><span class="pre">mua</span></code> in m <sup>-1</sup>.</p>
</div>
<div class="section" id="the-photon-packet-source">
<h2>The photon packet source<a class="headerlink" href="#the-photon-packet-source" title="Permalink to this headline">¶</a></h2>
<p>Different sources of photon packets are available through the
<a class="reference internal" href="../../../apidoc/xopto.mccyl.mcsource.html#module-xopto.mccyl.mcsource" title="xopto.mccyl.mcsource"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mccyl.mcsource</span></code></a> module. In this example we use a
collimated Gaussian source that enters the sample in the direction of the
<img class="math" src="../../../_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.png" alt="x"/> axis. The standard deviation of the beam is set to
<img class="math" src="../../../_images/math/c591c3d70382a746674a6a27bfd97eefd1cd9aa2.png" alt="\sigma=1"/> mm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mcsource</span><span class="o">.</span><span class="n">GaussianBeam</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-trace">
<h2>The trace<a class="headerlink" href="#the-trace" title="Permalink to this headline">¶</a></h2>
<p>The traces of photon packets can be collected by a trace detector
<a class="reference internal" href="../../../apidoc/xopto.mcbase.mctrace.html#xopto.mcbase.mctrace.Trace" title="xopto.mcbase.mctrace.Trace"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code></a> that is
available through the <a class="reference internal" href="../../../apidoc/xopto.mccyl.mctrace.html#module-xopto.mccyl.mctrace" title="xopto.mccyl.mctrace"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.mccyl.mctrace</span></code></a> module. The maximum
number of events that can be traced for each photon packet is limited to 128.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trace</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mctrace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-opencl-device">
<h2>The OpenCL device<a class="headerlink" href="#the-opencl-device" title="Permalink to this headline">¶</a></h2>
<p>The OpenCL device that will run the MC simulations can be selected through the
<a class="reference internal" href="../../../apidoc/xopto.cl.clinfo.html#module-xopto.cl.clinfo" title="xopto.cl.clinfo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xopto.cl.clinfo</span></code></a> module. In the following example we pick the first
available GPU device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gpu</span> <span class="o">=</span> <span class="n">clinfo</span><span class="o">.</span><span class="n">gpu</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="the-monte-carlo-simulator">
<h2>The Monte Carlo simulator<a class="headerlink" href="#the-monte-carlo-simulator" title="Permalink to this headline">¶</a></h2>
<p>Next, we create a Monte Carlo simulator instance from the created layer stack,
photon packet source and trace detector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mc_obj</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">Mc</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">cl_devices</span><span class="o">=</span><span class="n">gpu</span><span class="p">)</span>
</pre></div>
</div>
<p>Optionally, we can limit the maximum simulation radius that is measured from
the position of the photon packet source. In this example, we limit the
simulation radius to 100 mm, which exceeds the radius of the outer
sample boundary (50 mm)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mc_obj</span><span class="o">.</span><span class="n">rmax</span> <span class="o">=</span> <span class="mf">1000.0e-3</span>
</pre></div>
</div>
<p>Finally, we can run the simulator instance with a given number of photon
packets (100 in this example) and collect the results. The simulator
returns three objects/results, namely the trace, fluence and detectors. Since
in this example we only use the trace, the remaining two
results (detectors and fluence) will be returned as <code class="code python docutils literal notranslate"><span class="keyword constant"><span class="pre">None</span></span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trace_res</span><span class="p">,</span> <span class="n">fluence_res</span><span class="p">,</span> <span class="n">detectors_res</span> <span class="o">=</span> <span class="n">mc_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualization-of-results">
<h2>Visualization of results<a class="headerlink" href="#visualization-of-results" title="Permalink to this headline">¶</a></h2>
<p>We can plot the simulation results using the
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a>
module.</p>
<p>The traces can be plot using the <a class="reference internal" href="../../../apidoc/xopto.mcbase.mctrace.html#xopto.mcbase.mctrace.Trace.plot" title="xopto.mcbase.mctrace.Trace.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xopto.mcbase.mctrace.Trace.plot()</span></code></a> method.
In this example we plot the traces in the x-y plane, which can be selected
through the <code class="code python docutils literal notranslate"><span class="name"><span class="pre">view</span></span></code> argument. The results are plot onto an existing
axis that is set through the <code class="code python docutils literal notranslate"><span class="name"><span class="pre">ax</span></span></code> parameter. Finally, we also plot
the glass cylinder and the outer boundary of the sample, set the aspect ration
of the x and y axis to equal, add a legend and show the plot window.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># crate a plot window and a plot axis</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># plot the packet traces projected onto the x-y plane</span>
<span class="n">trace_res</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># plot the glass cylindr</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">5.0e-3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;glass cylinder&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cylinder</span><span class="p">)</span>
<span class="c1"># plot the outer boundary of the sample</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">25e-3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sample boundary&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>

<span class="c1"># add axis labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (m)&#39;</span><span class="p">)</span>

<span class="c1"># make aspect ratio of the x and y axis equal</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># show plot legend</span>
<span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># display the plot window</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Collected traces of the photon packets.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/trace.svg"><img alt="../../../_images/trace.svg" src="../../../_images/trace.svg" width="100%" /></a>
</div>
</div>
<div class="section" id="the-complete-example">
<h2>The complete example<a class="headerlink" href="#the-complete-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">################################ Begin license #################################</span>
<span class="c1"># Copyright (C) Laboratory of Imaging technologies,</span>
<span class="c1">#               Faculty of Electrical Engineering,</span>
<span class="c1">#               University of Ljubljana.</span>
<span class="c1">#</span>
<span class="c1"># This file is part of PyXOpto.</span>
<span class="c1">#</span>
<span class="c1"># PyXOpto is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># PyXOpto is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with PyXOpto. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1">################################# End license ##################################</span>

<span class="kn">from</span> <span class="nn">xopto.mccyl</span> <span class="kn">import</span> <span class="n">mc</span>
<span class="kn">from</span> <span class="nn">xopto.cl</span> <span class="kn">import</span> <span class="n">clinfo</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">pp</span>


<span class="c1"># creating the sample layer and the layer of the surrounding medium</span>
<span class="n">layers</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layers</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">50.0e-3</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">mclayer</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.45</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">10.0e-3</span><span class="p">,</span> <span class="n">mua</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="mf">0.0e2</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">mcpf</span><span class="o">.</span><span class="n">Hg</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="c1"># creating the source of photon packets</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mcsource</span><span class="o">.</span><span class="n">GaussianBeam</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span>


<span class="c1"># creating the trace object that can hold 128 events per each photon packet</span>
<span class="n">trace</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mctrace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>


<span class="c1"># selecting the first available OpenCL GPU device</span>
<span class="n">gpu</span> <span class="o">=</span> <span class="n">clinfo</span><span class="o">.</span><span class="n">gpu</span><span class="p">()</span>


<span class="c1"># creating a Monte Carlo simulator</span>
<span class="n">mc_obj</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">Mc</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">cl_devices</span><span class="o">=</span><span class="n">gpu</span><span class="p">)</span>
<span class="n">mc_obj</span><span class="o">.</span><span class="n">rmax</span> <span class="o">=</span> <span class="mf">100.0e-3</span>


<span class="c1"># running the MC simulation with 100 photon packets</span>
<span class="n">trace_res</span><span class="p">,</span> <span class="n">fluence_res</span><span class="p">,</span> <span class="n">detectors_res</span> <span class="o">=</span> <span class="n">mc_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># crate a plot window and a plot axis</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># plot the packet traces projected onto the x-y plane</span>
<span class="n">trace_res</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># plot the glass cylindr</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">5.0e-3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                     <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;glass cylinder&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cylinder</span><span class="p">)</span>
<span class="c1"># plot the outer boundary of the sample</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">25e-3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                     <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sample boundary&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>

<span class="c1"># add axis labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (m)&#39;</span><span class="p">)</span>

<span class="c1"># make aspect ratio of the x and y axis equal</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># show plot legend</span>
<span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># display the plot window</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This example can be run from the root directory of the PyXOpto package as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python examples/mccyl/tracing.py
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../mcvox/index.html" class="btn btn-neutral float-right" title="Voxelized MC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="basic_example.html" class="btn btn-neutral float-left" title="Basic example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, XOpto team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>